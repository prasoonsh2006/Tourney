<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Souls Of Soulcity - Tournament Standings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        :root {
            --f1-red: #e10600;
            --f1-black: #0b0b0b;
            --f1-text-dim: #949494;
            --color-dark-grey: rgb(5, 5, 5);
            --color-light-grey: #ffffff;
            --navbar-h: 80px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--f1-black); color: white; font-family: 'Poppins', sans-serif; overflow-x: hidden; }

        /* -------------------- NAV STYLES -------------------- */
        .logo { position: fixed; top: 23px; left: 40px; z-index: 101; font-family: "Kaushan Script", sans-serif; font-weight: bolder; font-size: 24px; color: #e4e3d3; text-decoration: none; transition: 0.3s; }
        nav { position: fixed; top: 0; left: 0; width: 100%; height: var(--navbar-h); z-index: 99; display: flex; align-items: center; background-color: transparent; transition: all 0.4s ease; }
        nav.scrolled { background-color: rgba(11, 11, 11, 0.95); backdrop-filter: blur(10px); height: 70px; }
        .nav-bar { width: 100%; display: flex; justify-content: flex-end; align-items: center; list-style: none; padding: 0 40px; }
        .menu { display: flex; list-style: none; }
        .menu li { padding-left: 30px; }
        .menu li a { color: #fff; text-decoration: none; text-transform: uppercase; font-size: 13px; font-weight: 600; transition: 0.3s; }
        .menu li a:hover { color: var(--f1-red); }
        .open-menu, .close-menu { display: none; color: #fff; cursor: pointer; font-size: 1.5rem; }
        #check { display: none; }

        @media(max-width: 950px) {
            .open-menu { display: block; }
            .menu { position: fixed; top: 0; right: -100%; width: 70%; height: 100vh; background: #0a0a0a; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; z-index: 100; }
            .menu li { padding: 20px 0; }
            .close-menu { display: block; position: absolute; top: 25px; right: 25px; }
            #check:checked ~ .menu { right: 0; }
        }

        /* -------------------- HERO SECTION -------------------- */
        .dashboard { display: flex; margin-top: var(--navbar-h); min-height: calc(100vh - var(--navbar-h)); }

        .hero-section {
            flex: 1;
            padding: 60px;
            position: sticky;
            top: var(--navbar-h);
            height: calc(100vh - var(--navbar-h));
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }

        .hero-image-container {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            opacity: 0.7;
            filter: grayscale(1) contrast(1.1);
        }

        .hero-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%),
            linear-gradient(to left, black 70%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%),
            linear-gradient(to left, black 70%, transparent 100%);
            -webkit-mask-composite: source-in;
            mask-composite: intersect;
        }

        .f1-tag { color: var(--f1-red); font-weight: 900; letter-spacing: 2px; font-size: 0.8rem; margin-bottom: 10px; text-transform: uppercase; z-index: 2; }
        .hero-section h1 { font-size: 5.5rem; font-weight: 900; line-height: 0.8; text-transform: uppercase; margin: 0; z-index: 2; }
        .outline-text { font-size: 3.8rem; -webkit-text-stroke: 1px white; color: transparent; text-transform: uppercase; z-index: 2; }

        /* -------------------- TABLE SECTION -------------------- */
        .standings-section { flex: 1.8; padding: 40px; }
        .tab-nav { display: flex; gap: 30px; margin-bottom: 30px; border-bottom: 1px solid #252525; }
        .tab-btn { background: none; border: none; color: var(--f1-text-dim); font-weight: 800; text-transform: uppercase; cursor: pointer; padding: 15px 0; border-bottom: 3px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: white; border-bottom: 3px solid var(--f1-red); }
        .f1-table { width: 100%; border-collapse: collapse; }
        .f1-table th { text-align: left; color: var(--f1-text-dim); font-size: 0.75rem; text-transform: uppercase; padding: 15px; border-bottom: 1px solid #252525; }
        .f1-table td { padding: 22px 15px; border-bottom: 1px solid #252525; }
        .main-row { cursor: pointer; transition: 0.2s; }
        .main-row:hover { background: rgba(255,255,255,0.05); }
        .rank-col { font-size: 1.4rem; font-weight: 900; width: 60px; }
        .pts-col { text-align: right; font-weight: 800; font-size: 1.3rem; }
        .detail-row { display: none; background: #111; }
        .race-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .race-table td, .race-table th { padding: 12px; border-bottom: 1px solid #222; }

        /* -------------------- FOOTER -------------------- */
        .site-footer {
            background-color: #0b0b0b;
            color: white;
            padding: 60px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: left;
        }
        .footer-content { max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: wrap; justify-content: space-between; gap: 40px; }
        .footer-logo, .footer-links, .footer-contact { flex: 1 1 300px; }
        .footer-logo h3 { font-family: "Kaushan Script", sans-serif; font-size: 2.2rem; color: white; margin-bottom: 15px; }
        .footer-logo p { opacity: 0.8; line-height: 1.6; }

        .footer-links h4, .footer-contact h4 {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-transform: capitalize;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
            width: fit-content;
            min-width: 200px;
        }

        .footer-links ul { list-style: none; }
        .footer-links a {
            color: white;
            text-decoration: none;
            display: block;
            margin-bottom: 12px;
            transition: 0.3s;
            opacity: 0.9;
        }
        .footer-links a:hover { color: var(--f1-red); padding-left: 5px; opacity: 1; }

        .footer-contact p { margin-bottom: 15px; opacity: 0.9; }
        .footer-contact .social-icons { display: flex; gap: 20px; font-size: 1.6rem; }
        .footer-contact a { color: white; transition: 0.3s; text-decoration: none; }
        .footer-contact a:hover { color: var(--f1-red); transform: translateY(-3px); }

        @media (max-width: 950px) {
            .dashboard { flex-direction: column; }
            .hero-section { position: relative; height: 400px; top: 0; padding: 40px; }
            .hero-section h1 { font-size: 3.5rem; }
            .outline-text { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

<a href="index.html" class="logo">Souls Of Soulcity</a>

<nav id="main-nav">
    <ul class='nav-bar'>
        <input type='checkbox' id='check' />
        <span class="menu">
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="crews.html">Crews</a></li>
            <li><a href="rankings.html" style="color:var(--f1-red)">Rankings</a></li>
            <li><a href="Watch.html">Watch</a></li>
            <li><a href="login.html">Login</a></li>
            <label for="check" class="close-menu"><i class="fas fa-times"></i></label>
        </span>
        <label for="check" class="open-menu"><i class="fas fa-bars"></i></label>
    </ul>
</nav>

<div class="dashboard">
    <aside class="hero-section">
        <div class="hero-image-container"><img src="" id="hero-img"></div>
        <div class="f1-tag" id="hero-tag">QUALIFIERS LEADER</div>
        <div id="hero-name-container">
            <h1 id="hero-first">LOADING</h1>
            <h1 class="outline-text" id="hero-last">DATA</h1>
        </div>
    </aside>

    <main class="standings-section">
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('phase1')">Qualifiers</button>
            <button class="tab-btn" onclick="switchTab('phase2')">Knockouts</button>
        </div>
        <div id="phase1-container">
            <table class="f1-table">
                <thead><tr><th>Pos</th><th>Crew</th><th style="text-align:right">Pts</th></tr></thead>
                <tbody id="phase1-body"></tbody>
            </table>
        </div>
        <div id="phase2-container" style="display:none;">
            <table class="f1-table">
                <thead><tr><th>Pos</th><th>Crew</th><th style="text-align:right">Pts</th></tr></thead>
                <tbody id="phase2-body"></tbody>
            </table>
        </div>
    </main>
</div>

<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-logo">
            <h3>Souls Of Soulcity</h3>
            <p>The premier underground racing league. <br>Draft. Race. Survive. Conquer.</p>
        </div>
        <div class="footer-links">
            <h4>Quick Lanes</h4>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">Tournament Info</a></li>
                <li><a href="crews.html">Crews & Teams</a></li>
                <li><a href="rankings.html">Leaderboards</a></li>
                <li><a href="Watch.html">Live Broadcast</a></li>
            </ul>
        </div>
        <div class="footer-contact">
            <h4>Connect</h4>
            <div class="social-icons">
                <a href="https://www.youtube.com/headflicker" target="_blank"><i class="fab fa-youtube"></i></a>
                <a href="https://discord.gg/phmcfrQ4" target="_blank"><i class="fab fa-discord"></i></a>
                <a href="https://www.instagram.com/8bit_headflicker/" target="_blank"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>
</footer>

<script>
    const PHASE_1_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS4ud-4K7CF0Xdi3VK3Snca_xV9huBCAg--xoRyhPVuCxfI6yzuD3ZSsuVngiRJQ_KfXXZRBfJzG5Kq/pub?gid=933387074&single=true&output=csv';
    const PHASE_2_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS4ud-4K7CF0Xdi3VK3Snca_xV9huBCAg--xoRyhPVuCxfI6yzuD3ZSsuVngiRJQ_KfXXZRBfJzG5Kq/pub?gid=882333842&single=true&output=csv';

    let currentPhase = 'phase1';
    let dataStore = { phase1: [], phase2: [] };
    let headersStore = { phase1: [], phase2: [] };
    const DEFAULT_IMAGE = "images/Chotu18.png";

    async function init() {
        await Promise.all([loadSheet('phase1', PHASE_1_URL), loadSheet('phase2', PHASE_2_URL)]);
        render('phase1');
        if (dataStore.phase1.length > 0) {
            updateHero(dataStore.phase1[0].name, dataStore.phase1[0].image, 0, 'phase1');
        }
    }

    async function loadSheet(key, url) {
        try {
            const res = await fetch(url);
            const text = await res.text();
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            headersStore[key] = headers;

            const rows = lines.slice(1).map(l => {
                const v = l.split(',');
                const o = {};
                headers.forEach((h, i) => o[h] = v[i]?.trim().replace(/"/g, '') || '');
                return o;
            });

            const processedCrews = [];
            let currentCrew = null;

            rows.forEach(r => {
                if (r['Crew Name'] && r['Crew Name'] !== "") {
                    currentCrew = {
                        name: r['Crew Name'],
                        id: r['ID'],
                        image: r['Image'] || DEFAULT_IMAGE,
                        total: 0,
                        races: []
                    };
                    processedCrews.push(currentCrew);
                } else if (currentCrew && r['Racer Name'] && r['Racer Name'] !== "") {
                    currentCrew.total = parseFloat(r['Total Points']) || 0;
                    currentCrew.races.push(r);
                }
            });

            dataStore[key] = processedCrews.sort((a, b) => b.total - a.total);
        } catch (e) { console.error("Error loading sheet:", e); }
    }

    function render(key) {
        const body = document.getElementById(`${key}-body`);
        const subHeaders = headersStore[key].filter(h => h !== 'Crew Name' && h !== 'ID' && h !== 'Image');

        body.innerHTML = dataStore[key].map((crew, i) => `
            <tr class="main-row" onclick="toggleCrew('${key}', ${i})">
                <td class="rank-col">${i+1}</td>
                <td class="crew-col">${crew.name}</td>
                <td class="pts-col">${crew.total}</td>
            </tr>
            <tr id="detail-${key}-${i}" class="detail-row">
                <td colspan="3">
                    <table class="race-table">
                        <thead><tr>${subHeaders.map(h => `<th>${h}</th>`).join('')}</tr></thead>
                        <tbody>
                            ${crew.races.map(r => `<tr>${subHeaders.map(h => `<td>${r[h]}</td>`).join('')}</tr>`).join('')}
                        </tbody>
                    </table>
                </td>
            </tr>
        `).join('');
    }

    function toggleCrew(phase, index) {
        const crew = dataStore[phase][index];
        const rowId = `detail-${phase}-${index}`;
        const row = document.getElementById(rowId);
        const isOpening = row.style.display !== 'table-row';

        document.querySelectorAll('.detail-row').forEach(r => r.style.display = 'none');
        if (isOpening) row.style.display = 'table-row';

        updateHero(crew.name, crew.image, index, phase);
    }

    function updateHero(name, imageUrl, index, phase) {
        const heroFirst = document.getElementById('hero-first');
        const heroLast = document.getElementById('hero-last');
        const heroImg = document.getElementById('hero-img');
        const heroTag = document.getElementById('hero-tag');

        const rank = index + 1;
        const phaseName = phase === 'phase1' ? 'Qualifier' : 'Knockout';

        // Dynamic Title Logic
        let title = "";
        if (rank === 1) title = `${phaseName} Leader`;
        else if (rank === 2) title = `${phaseName} Runner-Up`;
        else title = `${phaseName} #${rank}`;

        heroTag.innerText = title;

        const parts = name.split(' ');
        heroFirst.innerText = parts[0];
        heroLast.innerText = parts.slice(1).join(' ') || 'TEAM';

        gsap.to(heroImg, {
            opacity: 0,
            duration: 0.3,
            onComplete: () => {
                heroImg.src = imageUrl || DEFAULT_IMAGE;
                gsap.to(heroImg, { opacity: 0.7, duration: 0.5 });
            }
        });

        gsap.fromTo("#hero-name-container", { opacity: 0, x: -30 }, { opacity: 1, x: 0, duration: 0.5 });
    }

    window.switchTab = (key) => {
        currentPhase = key;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`[onclick="switchTab('${key}')"]`).classList.add('active');
        document.getElementById('phase1-container').style.display = key === 'phase1' ? 'block' : 'none';
        document.getElementById('phase2-container').style.display = key === 'phase2' ? 'block' : 'none';

        if (dataStore[key].length > 0) {
            updateHero(dataStore[key][0].name, dataStore[key][0].image, 0, key);
        }
        render(key);
    };

    window.addEventListener('scroll', () => {
        const nav = document.getElementById('main-nav');
        window.scrollY > 50 ? nav.classList.add('scrolled') : nav.classList.remove('scrolled');
    });

    init();
</script>
</body>
</html>